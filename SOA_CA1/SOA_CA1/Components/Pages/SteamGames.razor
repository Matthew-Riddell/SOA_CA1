<!-- Matthew Riddell SOA CA1 - D00245674 -->
<!-- Steam Games Page -->
@using SOA_CA1.Services
@page "/steam-games"

<PageTitle>Steam Games</PageTitle>

<h3>List of Steam Games</h3>

@if (games == null)
{
    <p>Loading games...</p>
}
else if (games.Count == 0)
{
    <p>No games found.</p>
}
else
{
    <ul>
        @foreach (var game in games)
        {
            <li>
                <img src="@($"https://media.steampowered.com/steamcommunity/public/images/apps/{game.Appid}/{game.IconUrl}.jpg")"
                     width="32" height="32" /><span>@game.Name</span>
                <span> - Hours Played: @((game.PlaytimeForever / 60.0).ToString("F1"))</span> <!-- Game Data -->
               <!-- <span> - Current Players: @await GetPlayerCountAsync(game.Appid)</span> --> <!-- Player Count -->
            </li>
        }
    </ul>
}

@code {
    private List<SteamGame> games = new();

    // learned to inject in razor from:
    // https://blazor-university.com/dependency-injection/injecting-dependencies-into-blazor-components/
    [Inject] private SteamGameService SteamService { get; set; }

    // Steam Game Data
    protected override async Task OnInitializedAsync()
    {
        games = await SteamService.GetAllSteamGamesAsync();
    }

    // Steam Player Counts
    private async Task<int> GetPlayerCountAsync(int appId)
    {
        return await SteamService.GetCurrentPlayerCountAsync(appId);
    }
    
}